<!DOCTYPE html>
<html lang="vi" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoTask - ICIA Titanium</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800&family=Open+Sans:wght@400;500;600&display=swap"
        rel="stylesheet">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
</head>

<body>

    <!-- =====================  LANDING VIEW  ===================== -->
    <div id="view-landing" class="view-landing">
        <div class="landing-glass-container">
            <!-- Step 1: Role Selection -->
            <div id="landing-step-role" class="landing-step">
                <div class="landing-header">
                    <div class="logo-wrapper">
                        <i data-lucide="tree-deciduous"></i>
                    </div>
                    <h1 class="landing-title">EcoTask <span>Titanium</span></h1>
                    <p class="landing-subtitle" data-i18n="landing_subtitle">H·ªá th·ªëng Qu·∫£n l√Ω T√°i ch·∫ø & H·ªçc ƒë∆∞·ªùng Xanh
                    </p>
                </div>

                <div class="role-selection-v2">
                    <div class="role-option student" onclick="AppState.showLogin('student')">
                        <div class="role-visual">
                            <i data-lucide="graduation-cap"></i>
                        </div>
                        <h3 data-i18n="tab_student">H·ªçc sinh</h3>
                        <p data-i18n="role_student_desc">Qu√©t r√°c, ki·∫øm token & nh·∫≠n qu√†</p>
                    </div>
                    <div class="role-option teacher" onclick="AppState.showLogin('teacher')">
                        <div class="role-visual">
                            <i data-lucide="shield-check"></i>
                        </div>
                        <h3 data-i18n="tab_teacher">Gi√°o vi√™n</h3>
                        <p data-i18n="role_teacher_desc">Duy·ªát minh ch·ª©ng & qu·∫£n l√Ω s·ªë li·ªáu</p>
                    </div>
                </div>
            </div>

            <!-- Step 2: Integrated Login/Register -->
            <div id="landing-step-login" class="landing-step hidden">
                <div class="login-header">
                    <button class="back-btn" onclick="AppState.showLandingStep('role')">
                        <i data-lucide="arrow-left"></i>
                    </button>
                    <h2 id="login-title">ƒêƒÉng nh·∫≠p H·ªçc sinh</h2>
                </div>

                <form id="login-form-main" class="login-form-v2" onsubmit="AppState.handleLogin(event)">
                    <div class="form-grid">
                        <div class="form-field">
                            <label data-i18n="label_name">H·ªç v√† T√™n</label>
                            <input type="text" id="login-name" data-i18n="placeholder_name"
                                placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n..." required>
                        </div>

                        <div class="form-row student-only-fields">
                            <div class="form-field">
                                <label data-i18n="label_grade">Kh·ªëi</label>
                                <select id="login-grade" onchange="AppState.updateClassOptions()">
                                    <option value="6">Kh·ªëi 6</option>
                                    <option value="7">Kh·ªëi 7</option>
                                    <option value="8">Kh·ªëi 8</option>
                                    <option value="9">Kh·ªëi 9</option>
                                </select>
                            </div>
                            <div class="form-field">
                                <label data-i18n="label_class">L·ªõp</label>
                                <select id="login-class">
                                    <option value="1">L·ªõp .1</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-field teacher-only-fields hidden">
                            <label data-i18n="label_code">M√£ x√°c th·ª±c Gi√°o vi√™n</label>
                            <input type="password" id="login-code" data-i18n="placeholder_code"
                                placeholder="Nh·∫≠p m√£ code...">
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block">
                        <span data-i18n="btn_join">Tham gia ngay</span> <i data-lucide="arrow-right"></i>
                    </button>
                </form>
            </div>

            <div class="landing-footer-v2">
                <p>&copy; 2026 ICIA School Project - Titanium Division</p>
            </div>
        </div>
    </div>

    <div id="app-container" class="hidden">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="nav-brand" onclick="AppState.navigateTo('home')">
                <i data-lucide="tree-deciduous"></i>
                <span>EcoTask</span>
                <span class="badge">Titanium</span>
            </div>

            <!-- Desktop Menu -->
            <div class="nav-menu" id="nav-menu">
                <!-- Links will be dynamically inserted/hidden by JS -->
                <button class="nav-link active" onclick="AppState.navigateTo('home')" data-page="home">
                    <i data-lucide="home"></i> <span data-i18n="nav_home">Trang ch·ªß</span>
                </button>
                <button class="nav-link student-only" onclick="AppState.openDirectProof()" data-page="proof">
                    <i data-lucide="camera"></i> <span data-i18n="nav_proof">G·ª≠i minh ch·ª©ng</span>
                </button>
                <button class="nav-link student-only"
                    onclick="if(AppState.resetScanner) AppState.resetScanner(); AppState.navigateTo('scanner')"
                    data-page="scanner">
                    <i data-lucide="scan-line"></i> <span data-i18n="nav_scan">Qu√©t AI</span>
                </button>
                <button class="nav-link teacher-only hidden" onclick="AppState.navigateTo('teacher-panel')"
                    data-page="teacher-panel">
                    <i data-lucide="shield-check"></i> <span data-i18n="nav_teacher">X√©t duy·ªát</span>
                </button>
                <button class="nav-link" onclick="AppState.navigateTo('stats')" data-page="stats">
                    <i data-lucide="bar-chart-2"></i> <span data-i18n="nav_stats">Th·ªëng k√™</span>
                </button>
                <button class="nav-link student-only" onclick="AppState.navigateTo('rewards')" data-page="rewards">
                    <i data-lucide="gift"></i> <span data-i18n="nav_rewards">ƒê·ªïi qu√†</span>
                </button>
                <button class="nav-link" onclick="AppState.navigateTo('wiki')" data-page="wiki">
                    <i data-lucide="book-open"></i> <span data-i18n="nav_wiki">H∆∞·ªõng d·∫´n</span>
                </button>
            </div>

            <div class="nav-actions">
                <!-- Language Toggle -->
                <button class="nav-btn lang-btn" id="lang-toggle" onclick="AppState.toggleLanguage()">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/2/21/Flag_of_Vietnam.svg" alt="VN"
                        class="lang-flag" id="lang-icon">
                    <span id="lang-text">VN</span>
                </button>

                <!-- Dark Mode Toggle -->
                <button class="nav-btn" id="theme-toggle" aria-label="Toggle Dark Mode">
                    <i data-lucide="moon"></i>
                </button>

                <!-- User Avatar / Logout -->
                <div id="nav-user" class="nav-user-area" onclick="AppState.openUserMenu()">
                    <img id="nav-avatar" src="" alt="" class="nav-avatar">
                    <div class="nav-user-info">
                        <span id="nav-username" class="nav-username"></span>
                        <span id="nav-token-display" class="nav-tokens"><i data-lucide="leaf"
                                style="width:12px;height:12px"></i> <span id="nav-tokens">0</span> tokens</span>
                    </div>
                </div>
                <button class="nav-btn" onclick="AppState.logout()" title="ƒêƒÉng xu·∫•t">
                    <i data-lucide="log-out"></i>
                </button>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main id="main-content">
            <!-- PAGE: HOME -->
            <!-- ... existing page-home code ... -->
            <!-- Note: I will wrap existing pages or update them selectively -->
            <!-- For now, keeping the structure compatible -->

            <div id="page-home" class="page-view active">
                <!-- Mini Profile Context -->
                <div class="user-profile-context" id="user-profile-home">
                    <div class="profile-card-small">
                        <img src="" alt="User" class="profile-avatar">
                        <div class="profile-info">
                            <span class="profile-name">...</span>
                            <span class="profile-class">...</span>
                        </div>
                    </div>
                </div>

                <header class="hero">
                    <div class="hero-content">
                        <div class="hero-text">
                            <span class="hero-badge">
                                <i data-lucide="sparkles"></i>
                                <span data-i18n="hero_badge">Tr·ª£ l√Ω T√°i ch·∫ø Th·ªëng minh AI</span>
                            </span>
                            <h1 data-i18n="hero_title">Bi·∫øn r√°c th·∫£i th√†nh <span class="text-gradient">t√†i nguy√™n</span>
                            </h1>
                            <p data-i18n="hero_desc">S·ª≠ d·ª•ng tr√≠ tu·ªá nh√¢n t·∫°o (AI) ƒë·ªÉ ph√¢n lo·∫°i r√°c v√† theo d√µi t√°c ƒë·ªông
                                m√¥i
                                tr∆∞·ªùng c·ªßa to√†n tr∆∞·ªùng.</p>
                            <div class="hero-buttons">
                                <button class="btn btn-primary student-only" onclick="AppState.openDirectProof()">
                                    <i data-lucide="upload"></i> <span data-i18n="btn_proof_direct">G·ª≠i minh ch·ª©ng r√°c
                                        th·∫£i</span>
                                </button>
                                <button class="btn btn-outline student-only"
                                    onclick="if(AppState.resetScanner) AppState.resetScanner(); AppState.navigateTo('scanner')">
                                    <i data-lucide="scan-line"></i> <span data-i18n="btn_scan">Qu√©t r√°c (AI)</span>
                                </button>
                                <button class="btn btn-primary teacher-only hidden"
                                    onclick="AppState.navigateTo('teacher-panel')">
                                    <i data-lucide="shield-check"></i> <span data-i18n="nav_teacher_panel">B·∫Øt ƒë·∫ßu x√©t
                                        duy·ªát</span>
                                </button>
                                <button class="btn btn-outline" onclick="AppState.navigateTo('stats')">
                                    <i data-lucide="bar-chart-2"></i> <span data-i18n="btn_stats">Xem th·ªëng k√™</span>
                                </button>
                            </div>
                        </div>
                        <div class="hero-visual">
                            <div class="scanner-mockup">
                                <div class="scanner-frame">
                                    <div class="scan-line"></div>
                                    <div class="scan-overlay">
                                        <i data-lucide="scan"></i>
                                        <span data-i18n="ai_identifying">AI ƒëang nh·∫≠n di·ªán...</span>
                                    </div>
                                    <img src="https://images.unsplash.com/photo-1591193686104-fddba4d0e4d8?q=80&w=400&auto=format&fit=crop"
                                        alt="Plastic Bottle">
                                </div>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Quick Features Grid -->
                <section class="features-preview">
                    <div class="feature-card student-only"
                        onclick="if(AppState.resetScanner) AppState.resetScanner(); AppState.navigateTo('scanner')">
                        <div class="feature-icon"><i data-lucide="camera"></i></div>
                        <h3 data-i18n="feat_scan_title">Nh·∫≠n di·ªán AI</h3>
                        <p data-i18n="feat_scan_desc">Ph√¢n lo·∫°i r√°c t·ª± ƒë·ªông ch·ªâ trong 3 gi√¢y.</p>
                    </div>
                    <div class="feature-card teacher-only hidden" onclick="AppState.navigateTo('teacher-panel')">
                        <div class="feature-icon" style="background: var(--primary);"><i data-lucide="shield-check"></i>
                        </div>
                        <h3 data-i18n="feat_moderation_title">Ki·ªÉm duy·ªát</h3>
                        <p data-i18n="feat_moderation_desc">Duy·ªát b·∫±ng ch·ª©ng r√°c th·∫£i t·ª´ h·ªçc sinh.</p>
                    </div>
                    <div class="feature-card" onclick="AppState.navigateTo('stats')">
                        <div class="feature-icon"><i data-lucide="trending-up"></i></div>
                        <h3 data-i18n="feat_stats_title">Theo d√µi T√°c ƒë·ªông</h3>
                        <p data-i18n="feat_stats_desc">Xem s·ªë li·ªáu gi·∫£m th·∫£i CO2 th·ªùi gian th·ª±c.</p>
                    </div>
                    <div class="feature-card student-only" onclick="AppState.navigateTo('rewards')">
                        <div class="feature-icon" style="background:linear-gradient(135deg,var(--primary),#34D399);"><i
                                data-lucide="gift"></i></div>
                        <h3 data-i18n="feat_rewards_title">ƒê·ªïi qu√† & Ph·∫ßn th∆∞·ªüng</h3>
                        <p data-i18n="feat_rewards_desc">D√πng Green Token trao ƒë·ªïi qu√† t·ª´ tr∆∞·ªùng.</p>
                    </div>
                    <div class="feature-card" onclick="AppState.navigateTo('wiki')">
                        <div class="feature-icon"><i data-lucide="book"></i></div>
                        <h3 data-i18n="feat_wiki_title">Wiki T√°i ch·∫ø</h3>
                        <p data-i18n="feat_wiki_desc">H∆∞·ªõng d·∫´n chi ti·∫øt c√°ch x·ª≠ l√Ω t·ª´ng lo·∫°i r√°c.</p>
                    </div>
                </section>

                <!-- Submission History (Student Only) -->
                <section class="submission-history-box student-only">
                    <div class="history-card-v2">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                            <h3 data-i18n="history_title">L·ªãch s·ª≠ x√©t duy·ªát c·ªßa b·∫°n</h3>
                            <i data-lucide="history" style="color: var(--primary)"></i>
                        </div>
                        <div id="student-history-grid" class="history-grid-mini">
                            <!-- JS will render history here -->
                            <p data-i18n="history_empty"
                                style="grid-column: 1/-1; opacity: 0.5; text-align: center; padding: 20px;">B·∫°n ch∆∞a g·ª≠i
                                minh ch·ª©ng n√†o.</p>
                        </div>
                    </div>
                </section>
            </div>

            <!-- PAGE: SCANNER (Updated Flow) -->
            <div id="page-scanner" class="page-view hidden">
                <section class="scanner-section">
                    <div class="section-header">
                        <h2 data-i18n="scanner_title" id="scanner-title">M√°y Qu√©t R√°c AI</h2>
                        <p data-i18n="upload_desc" id="scanner-desc">Ch·ª•p ·∫£nh ho·∫∑c t·∫£i l√™n h√¨nh ·∫£nh r√°c ƒë·ªÉ AI ph√¢n lo·∫°i
                        </p>
                    </div>
                    <div class="scanner-container">
                        <div class="scanner-interface">
                            <div class="upload-zone" id="upload-zone">
                                <input type="file" id="ai-upload" accept="image/*" hidden>
                                <input type="file" id="ai-camera" accept="image/*" capture="environment" hidden>
                                <div class="upload-content">
                                    <i data-lucide="camera" class="upload-icon"></i>
                                    <h3 data-i18n="upload_title">Ch·ª•p ·∫£nh ho·∫∑c t·∫£i l√™n</h3>
                                    <p data-i18n="upload_desc">AI s·∫Ω t·ª± ƒë·ªông ph√¢n lo·∫°i r√°c gi√∫p b·∫°n</p>
                                    <div class="scanner-btn-row">
                                        <button class="btn btn-sm btn-primary"
                                            onclick="document.getElementById('ai-camera').click()">
                                            <i data-lucide="camera"></i> <span data-i18n="btn_camera">M·ªü Camera</span>
                                        </button>
                                        <button class="btn btn-sm btn-outline"
                                            onclick="document.getElementById('ai-upload').click()">
                                            <i data-lucide="image"></i> <span data-i18n="btn_upload">Ch·ªçn t·ª´ m√°y</span>
                                        </button>
                                    </div>
                                </div>
                                <div id="ai-preview" class="ai-preview hidden">
                                    <img id="preview-img" src="" alt="Preview">
                                    <div class="scanning-overlay" id="scanning-effect">
                                        <div class="scanner-circle"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 1 Results -->
                        <div class="scanner-result hidden" id="scanner-result">
                            <h3 data-i18n="result_title">K·∫øt qu·∫£ ph√¢n t√≠ch AI</h3>
                            <div class="result-card">
                                <div class="result-icon-wrapper" id="result-icon-wrapper">
                                    <i data-lucide="box"></i>
                                </div>
                                <div class="result-info">
                                    <h4 id="result-type">R√°c Nh·ª±a (Plastic)</h4>
                                    <p class="confidence"><span data-i18n="confidence">ƒê·ªô ch√≠nh x√°c:</span> <span
                                            id="result-confidence">98%</span></p>
                                    <p class="disposal-guide" id="result-guide"></p>
                                </div>
                            </div>

                            <!-- New Step: Proof Capture -->
                            <div class="proof-capture-area hidden" id="proof-step">
                                <h4 data-i18n="proof_title">B∆∞·ªõc 2: Ch·ª•p ·∫£nh b·∫±ng ch·ª©ng</h4>
                                <p data-i18n="proof_desc">H√£y ch·ª•p ·∫£nh b·∫°n b·ªè r√°c v√†o ƒë√∫ng th√πng quy ƒë·ªãnh.</p>
                                <input type="file" id="proof-camera" accept="image/*" capture="environment" hidden
                                    onchange="AppState.handleProofUpload(event)">
                                <div class="proof-btn-container">
                                    <button class="btn btn-primary"
                                        onclick="document.getElementById('proof-camera').click()">
                                        <i data-lucide="camera"></i> <span data-i18n="btn_proof">Ch·ª•p ·∫£nh b·∫±ng
                                            ch·ª©ng</span>
                                    </button>
                                </div>
                                <div id="proof-preview-container" class="proof-preview hidden"
                                    style="margin-top: 15px; border-radius: 12px; overflow: hidden; border: 2px dashed var(--border-color); text-align: center; background: rgba(0,0,0,0.2);">
                                    <img id="proof-preview-img" src="" alt="Proof Preview"
                                        style="max-height: 200px; max-width: 100%; object-fit: contain; margin: 0 auto; display: block;">
                                    <p class="proof-status-hint"
                                        style="font-size: 0.8rem; padding: 10px; color: var(--primary); font-weight: bold;">
                                        M·ªçi th·ª© ƒë√£ s·∫µn s√†ng!</p>
                                </div>
                            </div>

                            <div class="scanner-actions" id="scanner-confirm-step">
                                <button class="btn btn-primary btn-block" onclick="AppState.confirmResult()">
                                    <i data-lucide="check"></i> <span data-i18n="btn_confirm">X√°c nh·∫≠n & Ch·ª•p minh
                                        ch·ª©ng</span>
                                </button>
                            </div>

                            <div class="scanner-actions hidden" id="scanner-final-actions">
                                <button class="btn btn-primary btn-block" onclick="AppState.submitForModeration()">
                                    <i data-lucide="send"></i> <span data-i18n="btn_submit_proof">G·ª≠i b·∫±ng ch·ª©ng & Ch·ªù
                                        duy·ªát</span>
                                </button>
                            </div>
                            <div class="scanner-actions" id="scanner-reset-step">
                                <button class="btn btn-outline btn-block" onclick="AppState.resetScanner()">
                                    <i data-lucide="refresh-cw"></i> <span data-i18n="btn_rescan">Qu√©t l·∫°i t·ª´ ƒë·∫ßu</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- PAGE: TEACHER PANEL (NEW) -->
            <div id="page-teacher-panel" class="page-view hidden">
                <section class="teacher-section">
                    <div class="section-header">
                        <h2 data-i18n="nav_teacher_panel">Qu·∫£n L√Ω & Ki·ªÉm Duy·ªát</h2>
                        <div class="panel-tabs">
                            <button class="panel-tab active" onclick="AppState.switchTeacherTab('moderation')"
                                id="tch-tab-mod" data-i18n="tab_moderation">Ph√™ duy·ªát</button>
                            <button class="panel-tab" onclick="AppState.switchTeacherTab('stats-edit')"
                                id="tch-tab-stats" data-i18n="tab_stats_edit">C·∫≠p nh·∫≠t s·ªë li·ªáu</button>
                        </div>
                    </div>

                    <!-- Sub-page: Moderation -->
                    <div id="teacher-moderation" class="teacher-tab-content">
                        <div id="moderation-list" class="moderation-list">
                            <!-- Pending items will be rendered here -->
                            <div class="empty-state">
                                <i data-lucide="check-circle-2"></i>
                                <p>Hi·ªán kh√¥ng c√≥ y√™u c·∫ßu n√†o c·∫ßn duy·ªát.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Sub-page: Stats Editor -->
                    <div id="teacher-stats-edit" class="teacher-tab-content hidden">
                        <div class="stats-edit-card glass-card">
                            <h3 data-i18n="stats_update_success">C·∫≠p nh·∫≠t s·ªë li·ªáu to√†n tr∆∞·ªùng</h3>
                            <div class="form-group">
                                <label>L∆∞·ª£ng CO2 ƒë√£ gi·∫£m (kg)</label>
                                <input type="number" id="edit-co2" class="form-input" placeholder="24.5">
                            </div>
                            <div class="form-group">
                                <label>T·ªïng r√°c t√°i ch·∫ø (kg)</label>
                                <input type="number" id="edit-waste" class="form-input" placeholder="150">
                            </div>
                            <div class="form-group">
                                <label>S·ªë c√¢y xanh t∆∞∆°ng ƒë∆∞∆°ng</label>
                                <input type="number" id="edit-trees" class="form-input" placeholder="12">
                            </div>
                            <button class="btn btn-primary btn-block" onclick="AppState.saveGlobalStats()">C·∫≠p nh·∫≠t
                                ngay</button>
                        </div>
                    </div>
                </section>
            </div>

            <!-- PAGE: STATS -->
            <div id="page-stats" class="page-view hidden">
                <section class="dashboard-section">
                    <div class="section-header">
                        <h2 data-i18n="dashboard_title">Th·ªëng k√™ T√°c ƒë·ªông</h2>
                        <p id="dashboard-subtitle-text" data-i18n="dashboard_subtitle">D·ªØ li·ªáu th·ª±c t·∫ø t·ª´ to√†n tr∆∞·ªùng
                        </p>
                    </div>

                    <!-- Stats Controls -->
                    <div class="stats-controls">
                        <div class="scope-toggles">
                            <button class="scope-btn active" onclick="AppState.setStatsScope('class')" id="btn-class">
                                <i data-lucide="users"></i> <span data-i18n="filter_class">L·ªõp</span>
                            </button>
                            <button class="scope-btn" onclick="AppState.setStatsScope('grade')" id="btn-grade">
                                <i data-lucide="layers"></i> <span data-i18n="filter_grade">Kh·ªëi</span>
                            </button>
                            <button class="scope-btn" onclick="AppState.setStatsScope('school')" id="btn-school">
                                <i data-lucide="school"></i> <span data-i18n="filter_school">To√†n tr∆∞·ªùng</span>
                            </button>
                        </div>
                        <div class="filter-dropdowns">
                            <select id="grade-select" class="form-select hidden"
                                onchange="AppState.updateDashboardData()">
                                <option value="6">Kh·ªëi 6</option>
                                <option value="7">Kh·ªëi 7</option>
                                <option value="8">Kh·ªëi 8</option>
                                <option value="9" selected>Kh·ªëi 9</option>
                            </select>
                            <select id="class-select" class="form-select hidden"
                                onchange="AppState.updateDashboardData()">
                                <option value="9A1">L·ªõp 9A1</option>
                            </select>
                        </div>
                    </div>
                    <div class="dashboard-grid">
                        <div class="metric-card">
                            <div class="metric-icon leaf"><i data-lucide="leaf"></i></div>
                            <h3 id="stat-co2">24.5 kg</h3>
                            <p data-i18n="stat_co2_label">CO2 ƒê√£ gi·∫£m</p>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon recycle"><i data-lucide="recycle"></i></div>
                            <h3 id="stat-waste">150 kg</h3>
                            <p data-i18n="stat_waste_label">R√°c T√°i ch·∫ø</p>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon tree"><i data-lucide="tree-deciduous"></i></div>
                            <h3 id="stat-trees">12</h3>
                            <p data-i18n="stat_trees_label">C√¢y Xanh T∆∞∆°ng ƒë∆∞∆°ng</p>
                        </div>
                        <div class="chart-card">
                            <h3 data-i18n="chart_waste_title">Ph√¢n lo·∫°i r√°c th·∫£i</h3>
                            <div style="max-height:280px;position:relative"><canvas id="wasteChart"></canvas></div>
                        </div>
                        <div class="chart-card">
                            <h3 data-i18n="chart_trend_title">Xu h∆∞·ªõng h√†ng th√°ng</h3>
                            <div style="max-height:280px;position:relative"><canvas id="trendChart"></canvas></div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- PAGE: WIKI (Redesigned Tabs) -->
            <div id="page-wiki" class="page-view hidden">
                <section class="wiki-section">
                    <div class="section-header">
                        <h2 data-i18n="wiki_title">H∆∞·ªõng d·∫´n T√°i ch·∫ø</h2>
                        <p data-i18n="wiki_subtitle">Tra c·ª©u nhanh c√°ch x·ª≠ l√Ω c√°c lo·∫°i r√°c ph·ªï bi·∫øn</p>
                    </div>

                    <div class="wiki-tabs-new">
                        <button class="w-tab active" onclick="AppState.showWikiTab('guides')" id="w-tab-guides">
                            <i data-lucide="book-open"></i> <span data-i18n="tab_guides">C·∫©m nang</span>
                        </button>
                        <button class="w-tab" onclick="AppState.showWikiTab('videos')" id="w-tab-videos">
                            <i data-lucide="play-circle"></i> <span data-i18n="tab_videos">Video H∆∞·ªõng d·∫´n</span>
                        </button>
                    </div>

                    <div id="wiki-guides" class="wiki-grid"
                        style="grid-template-columns: repeat(auto-fit, minmax(24%, 1fr)); gap: 40px; justify-content: center;">
                        <div class="wiki-card" onclick="AppState.openWikiModal('plastic')"
                            style="cursor: pointer; padding: 10px; background: transparent; text-align: center; border: none; box-shadow: none; transition: all 0.3s ease;"
                            onmouseover="this.style.transform='translateY(-10px) scale(1.1)'"
                            onmouseout="this.style.transform='translateY(0) scale(1)'">
                            <img src="assets/plastic.png" alt="Nh·ª±a"
                                style="width: 100%; max-height: 380px; object-fit: contain; filter: drop-shadow(0 20px 30px rgba(0,0,0,0.3)); pointer-events: none;">
                        </div>
                        <div class="wiki-card" onclick="AppState.openWikiModal('paper')"
                            style="cursor: pointer; padding: 10px; background: transparent; text-align: center; border: none; box-shadow: none; transition: all 0.3s ease;"
                            onmouseover="this.style.transform='translateY(-10px) scale(1.1)'"
                            onmouseout="this.style.transform='translateY(0) scale(1)'">
                            <img src="assets/paper.png" alt="Gi·∫•y"
                                style="width: 100%; max-height: 380px; object-fit: contain; filter: drop-shadow(0 20px 30px rgba(0,0,0,0.3)); pointer-events: none;">
                        </div>
                        <div class="wiki-card" onclick="AppState.openWikiModal('metal')"
                            style="cursor: pointer; padding: 10px; background: transparent; text-align: center; border: none; box-shadow: none; transition: all 0.3s ease;"
                            onmouseover="this.style.transform='translateY(-10px) scale(1.1)'"
                            onmouseout="this.style.transform='translateY(0) scale(1)'">
                            <img src="assets/metal.png" alt="Kim lo·∫°i"
                                style="width: 100%; max-height: 380px; object-fit: contain; filter: drop-shadow(0 20px 30px rgba(0,0,0,0.3)); pointer-events: none;">
                        </div>
                        <div class="wiki-card" onclick="AppState.openWikiModal('glass')"
                            style="cursor: pointer; padding: 10px; background: transparent; text-align: center; border: none; box-shadow: none; transition: all 0.3s ease;"
                            onmouseover="this.style.transform='translateY(-10px) scale(1.1)'"
                            onmouseout="this.style.transform='translateY(0) scale(1)'">
                            <img src="assets/glass.png" alt="Th·ªßy tinh"
                                style="width: 100%; max-height: 380px; object-fit: contain; filter: drop-shadow(0 20px 30px rgba(0,0,0,0.3)); pointer-events: none;">
                        </div>
                        <div class="wiki-card" onclick="AppState.openWikiModal('organic')"
                            style="cursor: pointer; padding: 10px; background: transparent; text-align: center; border: none; box-shadow: none; transition: all 0.3s ease;"
                            onmouseover="this.style.transform='translateY(-10px) scale(1.1)'"
                            onmouseout="this.style.transform='translateY(0) scale(1)'">
                            <img src="assets/organic.png" alt="H·ªØu c∆°"
                                style="width: 100%; max-height: 380px; object-fit: contain; filter: drop-shadow(0 20px 30px rgba(0,0,0,0.3)); pointer-events: none;">
                        </div>
                        <div class="wiki-card" onclick="AppState.openWikiModal('ewaste')"
                            style="cursor: pointer; padding: 10px; background: transparent; text-align: center; border: none; box-shadow: none; transition: all 0.3s ease;"
                            onmouseover="this.style.transform='translateY(-10px) scale(1.1)'"
                            onmouseout="this.style.transform='translateY(0) scale(1)'">
                            <img src="assets/ewaste.png" alt="ƒêi·ªán t·ª≠"
                                style="width: 100%; max-height: 380px; object-fit: contain; filter: drop-shadow(0 20px 30px rgba(0,0,0,0.3)); pointer-events: none;">
                        </div>
                        <div class="wiki-card" onclick="AppState.openWikiModal('textile')"
                            style="cursor: pointer; padding: 10px; background: transparent; text-align: center; border: none; box-shadow: none; transition: all 0.3s ease;"
                            onmouseover="this.style.transform='translateY(-10px) scale(1.1)'"
                            onmouseout="this.style.transform='translateY(0) scale(1)'">
                            <img src="assets/textile.png" alt="V·∫£i"
                                style="width: 100%; max-height: 380px; object-fit: contain; filter: drop-shadow(0 20px 30px rgba(0,0,0,0.3)); pointer-events: none;">
                        </div>
                        <div class="wiki-card" onclick="AppState.openWikiModal('danger')"
                            style="cursor: pointer; padding: 10px; background: transparent; text-align: center; border: none; box-shadow: none; transition: all 0.3s ease;"
                            onmouseover="this.style.transform='translateY(-10px) scale(1.1)'"
                            onmouseout="this.style.transform='translateY(0) scale(1)'">
                            <img src="assets/danger.png" alt="Nguy h·∫°i"
                                style="width: 100%; max-height: 380px; object-fit: contain; filter: drop-shadow(0 20px 30px rgba(0,0,0,0.3)); pointer-events: none;">
                        </div>
                    </div>

                    <div id="wiki-videos" class="wiki-grid hidden">
                        <div class="video-card">
                            <div class="video-preview">
                                <img src="https://img.youtube.com/vi/6jQ7y_qQYUA/mqdefault.jpg" alt="Video thumb">
                                <button class="play-btn"><i data-lucide="play"></i></button>
                            </div>
                            <div class="video-info">
                                <h3>H∆∞·ªõng d·∫´n ph√¢n lo·∫°i r√°c t·∫°i ngu·ªìn</h3>
                                <p>C·∫©m nang c∆° b·∫£n cho h·ªçc sinh ICIA.</p>
                            </div>
                        </div>
                        <div class="video-card">
                            <div class="video-preview">
                                <img src="https://img.youtube.com/vi/V8f6X5OUp4A/mqdefault.jpg" alt="Video thumb">
                                <button class="play-btn"><i data-lucide="play"></i></button>
                            </div>
                            <div class="video-info">
                                <h3>Quy tr√¨nh t√°i ch·∫ø nh·ª±a</h3>
                                <p>T√¨m hi·ªÉu xem r√°c nh·ª±a ƒëi ƒë√¢u sau khi b·ªè th√πng.</p>
                            </div>
                        </div>
                        <div class="video-card">
                            <div class="video-preview">
                                <img src="https://img.youtube.com/vi/unGIny009sw/mqdefault.jpg" alt="Video thumb">
                                <button class="play-btn"><i data-lucide="play"></i></button>
                            </div>
                            <div class="video-info">
                                <h3>L√†m ph√¢n compost t·∫°i tr∆∞·ªùng</h3>
                                <p>C√°ch t·∫≠n d·ª•ng r√°c h·ªØu c∆° t·ª´ canteen.</p>
                            </div>
                        </div>
                        <!-- New Videos Added -->
                        <div class="video-card">
                            <div class="video-preview">
                                <img src="https://images.unsplash.com/photo-1532996122724-e3c354a0b15f?w=400&q=80"
                                    alt="G·∫°ch sinh th√°i">
                                <button class="play-btn"><i data-lucide="play"></i></button>
                            </div>
                            <div class="video-info">
                                <h3>L√†m g·∫°ch sinh th√°i (Ecobrick) t·ª´ r√°c nh·ª±a</h3>
                                <p>T√°i ch·∫ø t√∫i nilon v√† v·ªè chai nh·ª±a d√πng m·ªôt l·∫ßn.</p>
                            </div>
                        </div>
                        <div class="video-card">
                            <div class="video-preview">
                                <img src="https://images.unsplash.com/photo-1549429141-8fbbc95583b4?w=400&q=80"
                                    alt="T√°i ch·∫ø qu·∫ßn √°o">
                                <button class="play-btn"><i data-lucide="play"></i></button>
                            </div>
                            <div class="video-info">
                                <h3>L√†m m·ªõi qu·∫ßn √°o c≈© (Upcycle)</h3>
                                <p>ƒê·ª´ng v·ª©t qu·∫ßn √°o c≈©, h√£y bi·∫øn ch√∫ng th√†nh t√∫i tote.</p>
                            </div>
                        </div>
                        <div class="video-card">
                            <div class="video-preview">
                                <img src="https://images.unsplash.com/photo-1581452140510-cdcc92e4abfa?w=400&q=80"
                                    alt="R√°c nguy h·∫°i">
                                <button class="play-btn"><i data-lucide="play"></i></button>
                            </div>
                            <div class="video-info">
                                <h3>X·ª≠ l√Ω pin v√† ƒë·ªì ƒëi·ªán t·ª≠ c≈© an to√†n</h3>
                                <p>Nh·ªØng l∆∞u √Ω quan tr·ªçng ƒë·ªÉ b·∫£o v·ªá m√¥i tr∆∞·ªùng.</p>
                            </div>
                        </div>
                        <div class="video-card">
                            <div class="video-preview">
                                <img src="https://images.unsplash.com/photo-1605600659873-d808a1d85795?w=400&q=80"
                                    alt="T√°i ch·∫ø r√°c t·∫°i nh√†">
                                <button class="play-btn"><i data-lucide="play"></i></button>
                            </div>
                            <div class="video-info">
                                <h3>T√°i ch·∫ø c√°c lo·∫°i r√°c th·∫£i nh·ª±a t·∫°i nh√†</h3>
                                <p>H∆∞·ªõng d·∫´n chi ti·∫øt bi·∫øn r√°c th√†nh v·∫≠t d·ª•ng h·ªØu √≠ch.</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- PAGE: REWARDS -->
            <div id="page-rewards" class="page-view hidden">
                <section class="wiki-section">
                    <div class="section-header">
                        <h2 data-i18n="rewards_title">ƒê·ªïi qu√† &amp; Ph·∫ßn th∆∞·ªüng</h2>
                        <p data-i18n="rewards_subtitle">D√πng Green Token ki·∫øm ƒë∆∞·ª£c ƒë·ªÉ ƒë·ªïi l·∫•y ∆∞u ƒë√£i t·ª´ nh√† tr∆∞·ªùng</p>
                    </div>
                    <div class="token-banner">
                        <div class="token-balance">
                            <i data-lucide="leaf"></i>
                            <div>
                                <div class="token-amount" id="rewards-token-count">0</div>
                                <div class="token-label" data-i18n="token_label">Green Tokens c·ªßa b·∫°n</div>
                            </div>
                        </div>
                        <div class="token-tip" data-i18n="token_earn_tip">üí° Qu√©t r√°c + x√°c nh·∫≠n t√°i ch·∫ø ƒë·ªÉ ki·∫øm token!
                        </div>
                    </div>
                    <div class="wiki-grid" id="rewards-grid">
                        <!-- Dynamic Rewards will be injected by AppState.renderRewards() -->
                    </div>
                </section>
            </div>
        </main>

        <!-- Wiki Item Modal -->
        <div id="wiki-modal" class="modal-overlay hidden">
            <div class="modal-content"
                style="max-width: 600px; max-height: 85vh; display: flex; flex-direction: column;">
                <div
                    style="background: var(--bg-secondary); padding: 25px; text-align: center; border-bottom: 1px solid var(--border-color); position: relative; flex-shrink: 0;">
                    <button onclick="AppState.closeWikiModal()"
                        style="position: absolute; right: 20px; top: 20px; background: rgba(255,255,255,0.1); border: none; color: var(--text-main); width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s;"
                        onmouseover="this.style.background='rgba(255,100,100,0.2)'; this.style.color='#ef4444'"
                        onmouseout="this.style.background='rgba(255,255,255,0.1)'; this.style.color='var(--text-main)'">
                        <i data-lucide="x"></i>
                    </button>
                    <img id="wiki-modal-img" src="" alt="Icon"
                        style="width: 140px; height: 140px; object-fit: contain; filter: drop-shadow(0 15px 25px rgba(0,0,0,0.2)); margin-bottom: 15px;">
                    <h2 id="wiki-modal-title" style="font-size: 1.8rem; font-weight: 800; color: var(--primary);">Title
                    </h2>
                </div>
                <div style="padding: 25px; overflow-y: auto; flex-grow: 1;">
                    <p id="wiki-modal-desc"
                        style="font-size: 1.05rem; color: var(--text-muted); line-height: 1.6; text-align: center; margin-bottom: 25px;">
                        Description</p>

                    <h4
                        style="margin-bottom: 15px; font-size: 1.1rem; border-bottom: 2px solid var(--border-color); padding-bottom: 8px;">
                        V√≠ d·ª• minh h·ªça: (<span id="wiki-modal-count"></span> m·ª•c)</h4>
                    <div id="wiki-modal-examples"
                        style="display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 15px;">
                        <!-- Examples injected here via JS -->
                    </div>
                </div>
            </div>
        </div>

        <footer class="footer">
            <div class="footer-content">
                <div class="footer-brand">
                    <i data-lucide="tree-deciduous"></i>
                    <span>EcoTask Titanium</span>
                    <p>Built with AI for a Green Future</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 ICIA Innovation Challenge.</p>
            </div>
        </footer>
    </div>


    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="app.js?v=2.9"></script>
    <script>
        lucide.createIcons();
    </script>
</body>

</html>